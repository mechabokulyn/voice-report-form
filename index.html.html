<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>éšœå®³å…ç«¥å¯¾å¿œå ±å‘Šãƒ•ã‚©ãƒ¼ãƒ </title>
</head>
<body>
  <h2>éšœå®³å…ç«¥å¯¾å¿œãƒ»å ±å‘Šãƒ•ã‚©ãƒ¼ãƒ </h2>
  <form id="reportForm">
    <label>å ±å‘Šè€…åï¼š<input type="text" name="reporter" required></label><br><br>
    <label>å¯¾è±¡å…ç«¥ï¼š<input type="text" name="child"></label><br><br>

    <label>çŠ¶æ³ï¼š<textarea name="situation" id="situation"></textarea></label><br>
    <button type="button" onclick="startDictation('situation')">ğŸ™ éŸ³å£°å…¥åŠ›</button><br><br>

    <label>å¯¾å¿œå†…å®¹ï¼š<textarea name="response" id="response"></textarea></label><br>
    <button type="button" onclick="startDictation('response')">ğŸ™ éŸ³å£°å…¥åŠ›</button><br><br>

    <label>æ‰€æ„Ÿãƒ»å‚™è€ƒï¼š<textarea name="remarks"></textarea></label><br><br>

    <button type="submit">é€ä¿¡</button>
  </form>

  <p id="status"></p>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbwtabzSes51ayP3elRyA21OZKFQSWEqYlRkYCv3nrXxQKL58t_AExpj9uWb_cFa8D55aQ/exec';

    document.getElementById('reportForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      fetch(scriptURL, {
        method: 'POST',
        mode: 'no-cors',
        body: formData
      })
      .then(() => document.getElementById('status').innerText = 'é€ä¿¡å®Œäº†ã—ã¾ã—ãŸ')
      .catch(error => document.getElementById('status').innerText = 'é€ä¿¡ã‚¨ãƒ©ãƒ¼: ' + error);
    });

    function startDictation(fieldId) {
      const recognition = new webkitSpeechRecognition();
      recognition.lang = 'ja-JP';
      recognition.continuous = true; // é•·ã‚ã®èªè­˜ã‚’å¯èƒ½ã«ã™ã‚‹
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;
      recognition.start();

      recognition.onresult = function(event) {
        let finalTranscript = '';
        for (let i = 0; i < event.results.length; ++i) {
          finalTranscript += event.results[i][0].transcript + '\n';
        }
        document.getElementById(fieldId).value = finalTranscript.trim();
      };

      recognition.onerror = function(event) {
        alert('éŸ³å£°èªè­˜ã‚¨ãƒ©ãƒ¼: ' + event.error);
      };
    }
  </script>
</body>
</html>
